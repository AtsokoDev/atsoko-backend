<VirtualHost *:80>
    ServerName api.thaiindustrialproperty.com
    
    # Document root (for static files if needed)
    DocumentRoot /var/www/atsoko-backend/public
    
    # Enable proxy modules (make sure they're loaded)
    # LoadModule proxy_module modules/mod_proxy.so
    # LoadModule proxy_http_module modules/mod_proxy_http.so
    
    # Increase upload size
    LimitRequestBody 52428800
    
    # Serve static files directly
    Alias /images/ /var/www/atsoko-backend/public/images/
    Alias /logo/ /var/www/atsoko-backend/public/logo/
    Alias /watermark/ /var/www/atsoko-backend/public/watermark/
    
    <Directory /var/www/atsoko-backend/public/>
        Options -Indexes +FollowSymLinks
        AllowOverride None
        Require all granted
        
        # CORS headers for all static files
        <IfModule mod_headers.c>
            Header set Access-Control-Allow-Origin "*"
            Header set Access-Control-Allow-Methods "GET, OPTIONS"
            Header set Access-Control-Allow-Headers "Content-Type"
        </IfModule>
        
        # Cache control for images
        <FilesMatch "\.(jpg|jpeg|png|gif|webp|svg|ico)$">
            <IfModule mod_expires.c>
                ExpiresActive On
                ExpiresDefault "access plus 1 year"
            </IfModule>
            Header set Cache-Control "public, immutable"
        </FilesMatch>
    </Directory>
    
    # Proxy all requests to Node.js app (except static files)
    ProxyPreserveHost On
    ProxyPass /images/ !
    ProxyPass /logo/ !
    ProxyPass /watermark/ !
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/
    
    # Proxy settings
    <Proxy *>
        Order deny,allow
        Allow from all
    </Proxy>
    
    # Security headers
    <IfModule mod_headers.c>
        Header always set X-Frame-Options "SAMEORIGIN"
        Header always set X-Content-Type-Options "nosniff"
        Header always set X-XSS-Protection "1; mode=block"
    </IfModule>
    
    # Compression
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/plain
        AddOutputFilterByType DEFLATE text/html
        AddOutputFilterByType DEFLATE text/xml
        AddOutputFilterByType DEFLATE text/css
        AddOutputFilterByType DEFLATE application/xml
        AddOutputFilterByType DEFLATE application/xhtml+xml
        AddOutputFilterByType DEFLATE application/rss+xml
        AddOutputFilterByType DEFLATE application/javascript
        AddOutputFilterByType DEFLATE application/x-javascript
        AddOutputFilterByType DEFLATE application/json
    </IfModule>
    
    # Logs
    ErrorLog /var/log/httpd/api-atsoko-error.log
    CustomLog /var/log/httpd/api-atsoko-access.log combined
</VirtualHost>

# HTTPS configuration (uncomment after obtaining SSL certificate)
# <VirtualHost *:443>
#     ServerName api.thaiindustrialproperty.com
#     
#     SSLEngine on
#     SSLCertificateFile /etc/letsencrypt/live/api.thaiindustrialproperty.com/fullchain.pem
#     SSLCertificateKeyFile /etc/letsencrypt/live/api.thaiindustrialproperty.com/privkey.pem
#     SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
#     SSLCipherSuite HIGH:!aNULL:!MD5
#     
#     # Same configuration as HTTP above
#     DocumentRoot /var/www/atsoko-backend/public
#     
#     Alias /images/ /var/www/atsoko-backend/public/images/
#     Alias /logo/ /var/www/atsoko-backend/public/logo/
#     Alias /watermark/ /var/www/atsoko-backend/public/watermark/
#     
#     <Directory /var/www/atsoko-backend/public/>
#         Options -Indexes +FollowSymLinks
#         AllowOverride None
#         Require all granted
#         
#         <IfModule mod_headers.c>
#             Header set Access-Control-Allow-Origin "*"
#             Header set Access-Control-Allow-Methods "GET, OPTIONS"
#             Header set Access-Control-Allow-Headers "Content-Type"
#         </IfModule>
#         
#         <FilesMatch "\.(jpg|jpeg|png|gif|webp|svg|ico)$">
#             <IfModule mod_expires.c>
#                 ExpiresActive On
#                 ExpiresDefault "access plus 1 year"
#             </IfModule>
#             Header set Cache-Control "public, immutable"
#         </FilesMatch>
#     </Directory>
#     
#     ProxyPreserveHost On
#     ProxyPass /images/ !
#     ProxyPass /logo/ !
#     ProxyPass /watermark/ !
#     ProxyPass / http://localhost:3000/
#     ProxyPassReverse / http://localhost:3000/
#     
#     <IfModule mod_headers.c>
#         Header always set X-Frame-Options "SAMEORIGIN"
#         Header always set X-Content-Type-Options "nosniff"
#         Header always set X-XSS-Protection "1; mode=block"
#     </IfModule>
#     
#     ErrorLog /var/log/httpd/api-atsoko-ssl-error.log
#     CustomLog /var/log/httpd/api-atsoko-ssl-access.log combined
# </VirtualHost>
